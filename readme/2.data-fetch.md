# Next.js의 Data Fetching

## CSR의 데이터 페칭

- 로딩 상태를 직접 구현해야 한다. (useState, useEffect)
- 리렌더링 과정을 직접 관리해야한다. (useEffect)

> 예제

```tsx
const [data, setData] = useState(null);
const [isLoading, setLoading] = useState(true);
useEffect(() => {
  fetch('https://.../data')
    .then((res) => res.json())
    .then((data) => {
      setData(data);
      setLoading(false);
    });
}, []);
return <div>{isLoading ? <p>Loading...</p> : <p>{data}</p>}</div>;
```

## Next.js의 데이터 페칭

- SSR (Server Side Rendering)

  - 서버에서 데이터를 가져와서 렌더링하기 때문에 로딩이 매우 빠르게 이뤄진다.

- API 요청
  - 첫번째로 fetch된 데이터가 캐싱된다.
  - 즉, 서버에 캐싱해둔 캐싱을 불러와 여러번 호출되는 것을 방지할 수 있다.

> 예제

```tsx
async function getData() {
  const res = await fetch('https://.../data');
  const data = await res.json();
  return data;
}

export default async function Home() {
  const data = await getData();
  return <div>{data}</div>;
}
```

## loading.tsx와 스트리밍

- `loading.tsx`

  - 서버에서 데이터를 가져오는 동안 로딩 상태를 추가할 수 있습니다.
  - 데이터가 준비되면 로딩 상태가 자동으로 새로운 콘텐츠로 대체됩니다.

- 스트리밍
  - 페이지의 HTML을 작은 조각으로 나누고, 점진적으로 해당 조각을 서버에서 클라이언트로 전송할 수 있습니다.
  - 우선순위가 높은 콘텐츠를 먼저 전송하여 페이지가 더 빨리 표시되도록 할 수 있습니다.

> [참고링크] https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming
